 # -*- coding: utf-8 -*-
import codecs



import asyncio

from aiogram.types import InlineQuery, \
    InputTextMessageContent, InlineQueryResultArticle

from aiogram.utils.markdown import link

from aiogram.types import ReplyKeyboardRemove, \
    ReplyKeyboardMarkup, KeyboardButton, \
    InlineKeyboardMarkup, InlineKeyboardButton

from modules import start as start
from aiogram import Bot, Dispatcher

bot = Bot(token="6802713066:AAGVk6AfFPkbf8gjKE4aAYvMOkG4LlvWwds")
dp = Dispatcher(bot)

user_cd = "user/"
film_cd = 'films/films.txt'
channels_cd = 'channels/channels.txt'
id_cd = 'id/id.txt'


adm_id = '738799040'

async def reg(a,b):
    try:
        try:
            with codecs.open(str(user_cd) + str(a) +".txt", 'r' ,encoding="UTF-8") as file:
                file.close()

        except:

            with codecs.open(str(user_cd) + str(a) +  ".txt", 'w' ,encoding="UTF-8") as file:
                file.write("{'name_film': 0,'link_film': 0,'num_film': 0,'quest': 0,'link_channel': 0}")
                file.close()


            with codecs.open("all_users/all_users.txt", 'r' ,encoding="UTF-8") as file:
                q = str(file.readline())
                q = eval(q)
                file.close()

            q.append(str(a))

            with codecs.open("all_users/all_users.txt", 'w' ,encoding="UTF-8") as file:
                file.write(str(q))
                file.close()


        with codecs.open(str(user_cd) + str(a) +".txt", 'r' ,encoding="UTF-8") as file:
            user_data = str(file.readline())
            file.close()

        return eval(str(user_data))

    except Exception as ex:
        print(ex)

@dp.callback_query_handler(text='view_films')
async def view_films_callback_handler(call):
    user = await reg(a=str(call.from_user.id), b=str(call.from_user.username))

    with codecs.open(str(film_cd), 'r', encoding="UTF-8") as file:
        films_data = str(file.readline())
        films_data = eval(films_data)
        file.close()

    films_keyboard = InlineKeyboardMarkup()

    for code, film_info in films_data.items():
        film_title = film_info[1]
        button = InlineKeyboardButton(film_title, callback_data=f'view_film_{code}')
        films_keyboard.add(button)

    await bot.send_message(call.from_user.id, text="–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∏–ª—å–º:", reply_markup=films_keyboard)

@dp.callback_query_handler(lambda c: c.data.startswith('view_film_'))
async def view_film_callback_handler(call):
    film_code = call.data.split('_')[2]

    with codecs.open(str(film_cd), 'r', encoding="UTF-8") as file:
        films_data = str(file.readline())
        films_data = eval(films_data)
        file.close()

    if film_code in films_data:
        film_info = films_data[film_code]
        film_text = f"üé¨ *–ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–∏–ª—å–º–∞:* {film_info[1]}\n\n** {film_info[2]}"
        await bot.send_photo(chat_id=call.from_user.id, photo=str(film_info[0]), caption=film_text, parse_mode='Markdown')
    else:
        await bot.send_message(call.from_user.id, text="–§–∏–ª—å–º –Ω–µ –Ω–∞–π–¥–µ–Ω.")

@dp.message_handler(commands=['admin'])
async def send_welcome(message):
    user = await reg(a=str(message.from_user.id), b=str(message.from_user.username))

    if str(adm_id) == str(message.from_user.id):
        inline_kb1 = InlineKeyboardMarkup()
        inline_btn_1 = InlineKeyboardButton('üìå–°–¥–µ–ª–∞—Ç—å —Ä–∞—Å—Å—ã–ª–∫—É ', callback_data='add_send')
        inline_btn_2 = InlineKeyboardButton('üìå–°–¥–µ–ª–∞—Ç—å —Ä–∞—Å—Å—ã–ª–∫—É —Å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–µ–π', callback_data='add_send_photo')
        inline_btn_3 = InlineKeyboardButton('üé•–î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å–º', callback_data='add_film')
        inline_btn_4 = InlineKeyboardButton('üìà–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞', callback_data='stat')
        inline_btn_5 = InlineKeyboardButton('üìå–£–¥–∞–ª–∏—Ç—å –Ω–æ–º–µ—Ä —Ñ–∏–ª—å–º–∞', callback_data='delete_number')
        inline_btn_6 = InlineKeyboardButton('üìã–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–ø–∏—Å–æ–∫ —Ñ–∏–ª—å–º–æ–≤', callback_data='view_films')
        inline_btn_exit = InlineKeyboardButton('üö™–í—ã—Ö–æ–¥', callback_data='exit_admin')

        inline_kb1.add(inline_btn_1).add(inline_btn_2).add(inline_btn_3).add(inline_btn_4).add(inline_btn_5).add(inline_btn_6)
        inline_kb1.add(inline_btn_exit)  # Add the "Exit" button

        await bot.send_message(chat_id=message.from_user.id, text='*–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å*', parse_mode='Markdown',
                               reply_markup=inline_kb1)
    else:

        await bot.send_message(chat_id=message.from_user.id, text='*‚ùå –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω.*', parse_mode='Markdown')




@dp.callback_query_handler(text='exit_admin')
async def exit_admin_callback_handler(call):
    user = await reg(a=str(call.from_user.id), b=str(call.from_user.username))

    # Reset any admin-specific data
    # For example, you may want to clear any ongoing actions in the admin panel
    # user['some_key'] = None

    with codecs.open(str(user_cd) + str(call.from_user.id) + ".txt", 'w', encoding="UTF-8") as file:
        file.write(str(user))
        file.close()

    # Clear the chat history and send a new message without an inline keyboard
    await dp.bot.send_message(chat_id=call.from_user.id, text="üîé –î–ª—è –ø–æ–∏—Å–∫–∞ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –ö–û–î —Ñ–∏–ª—å–º–∞/—Å–µ—Ä–∏–∞–ª–∞", parse_mode='Markdown')

    # Optional: You can also hide the keyboard here if you have any
    # await dp.bot.send_message(chat_id=call.from_user.id, text="–ü—Ä–∏–≤–µ—Ç! üëã –Ø - –±–æ—Ç –ø–æ –ø–æ–∏—Å–∫—É —Ñ–∏–ª—å–º–æ–≤...", reply_markup=types.ReplyKeyboardRemove())





@dp.message_handler(content_types=['photo'])
async def handle_docs_photo(message):

    user = await reg(a = str(message.from_user.id), b = str(message.from_user.username))


    if user['quest'] == 888:

        with codecs.open("id/id.txt", 'r' ,encoding="UTF-8") as file:
            q = str(file.readline())
            q = eval(q)
            file.close()

        q = int(q) + 1

        with codecs.open("id/id.txt", 'w' ,encoding="UTF-8") as file:
            file.write(str(q))
            file.close()

        await message.photo[-1].download('photo/photo_' + str(q) + '.jpg')


        user['quest'] = 0

        with codecs.open(str(user_cd) + str(message.from_user.id) +".txt", 'w' ,encoding="UTF-8") as file:
            file.write(str(user))
            file.close()

        with codecs.open("all_users/all_users.txt", 'r' ,encoding="UTF-8") as file:
            g = str(file.readline())
            g = eval(g)
            file.close()

        for i in g:
            try:
                print(1)
                await bot.send_photo(chat_id = i,photo = open('photo/photo_' + str(q) + '.jpg','rb'),caption = str(message.caption))
            except Exception as ex:
                print(ex)

        await bot.send_message(chat_id = message.from_user.id, text = '–†–∞—Å—Å—ã–ª–∫–∞ –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ.')


@dp.message_handler(commands = ['start'])
async def send_welcome(message):

    a = 0
    c = 0

    user = await reg(a = str(message.from_user.id), b = str(message.from_user.username))


    with codecs.open(str(channels_cd), 'r' ,encoding="UTF-8") as file:
        channels_me = str(file.readline())
        channels_me = eval(channels_me)
        file.close()


    if len(channels_me) == 0:
        c = 1
    else:
        inline_kb1 = InlineKeyboardMarkup()
        for i in channels_me:
            user_channel_status = await bot.get_chat_member(chat_id='@' + str(i), user_id= message.from_user.id)

            if user_channel_status["status"] == 'left':


                for i in channels_me:
                    inline_btn_1 = InlineKeyboardButton(str(channels_me[i]), url='https://t.me/'+ str(i))

                    inline_kb1.add(inline_btn_1)

                inline_btn_2 = InlineKeyboardButton('–ü–æ–∏—Å–∫', callback_data='check')
                inline_kb1.add(inline_btn_2)

                await bot.send_message(chat_id = message.from_user.id, text = '*üìù –î–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –±–æ—Ç–∞, –≤—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø–æ–¥–ø–∏—Å–∞–Ω—ã –Ω–∞ –Ω–∞—à–∏ –∫–∞–Ω–∞–ª—ã:*',reply_markup = inline_kb1,parse_mode = 'Markdown')
                c = 0
                break
            else:
                c = 1
    if c == 1:

       await bot.send_message(message.from_user.id, text = '*–Ω–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É üîç–ü–æ–∏—Å–∫ üëá*',parse_mode = 'Markdown',reply_markup = start.greet_kb1)


@dp.callback_query_handler(text = 'stat')
async def vote_up_cb_handler(call):
    user = await reg(a = str(call.from_user.id), b = str(call.from_user.username))

    with codecs.open("all_users/all_users.txt", 'r' ,encoding="UTF-8") as file:
        q = str(file.readline())
        q = eval(q)
        file.close()

    await bot.send_message(call.from_user.id, text = '*üìà–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª—é–¥–µ–π –≤ –±–æ—Ç–µ: ' + str(len(q)) + '*',parse_mode = 'Markdown')

@dp.callback_query_handler(text = 'add_channel')
async def vote_up_cb_handler(call):
    user = await reg(a = str(call.from_user.id), b = str(call.from_user.username))

    user['quest'] = 200

    with codecs.open(str(user_cd) + str(call.from_user.id) +".txt", 'w' ,encoding="UTF-8") as file:
        file.write(str(user))
        file.close()

    await bot.send_message(call.from_user.id, text = '*–í–≤–µ–¥–∏—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ –∫–∞–Ω–∞–ª –±–µ–∑ @\n\n–ü—Ä–∏–º–µ—Ä: –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–∞–Ω–∞–ª–∞ @twochannel, –≤–≤–µ–¥–∏—Ç–µ twochannel*',parse_mode = 'Markdown')

@dp.callback_query_handler(text = 'delete_number')
async def vote_up_cb_handler(call):
    user = await reg(a = str(call.from_user.id), b = str(call.from_user.username))

    user['quest'] = 6661

    with codecs.open(str(user_cd) + str(call.from_user.id) +".txt", 'w' ,encoding="UTF-8") as file:
        file.write(str(user))
        file.close()

    await bot.send_message(call.from_user.id, text = '*–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ñ–∏–ª—å–º–∞, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É–¥–∞–ª–∏—Ç—å*',parse_mode = 'Markdown')


@dp.callback_query_handler(text = 'delete_channel')
async def vote_up_cb_handler(call):
    user = await reg(a = str(call.from_user.id), b = str(call.from_user.username))

    user['quest'] = 500

    h = ''

    with codecs.open(str(user_cd) + str(call.from_user.id) +".txt", 'w' ,encoding="UTF-8") as file:
        file.write(str(user))
        file.close()

    with codecs.open(str(channels_cd), 'r' ,encoding="UTF-8") as file:
        channels_me = str(file.readline())
        channels_me = eval(channels_me)
        file.close()

    for i in channels_me:
        h = h + str(i) + '\n'

    await bot.send_message(call.from_user.id, text = '*–°–ø–∏—Å–æ–∫ –≤–∞—à–∏—Ö –∫–∞–Ω–∞–ª–æ–≤:\n' + str(h) + '\n\n–í–≤–µ–¥–∏—Ç–µ –æ–¥–Ω–æ –∏–∑ –Ω–∏—Ö, —á—Ç–æ–±—ã —É–¥–∞–ª–∏—Ç—å.*',parse_mode = 'Markdown')



@dp.callback_query_handler(text='add_send')
async def vote_up_cb_handler(call):
    user = await reg(a=str(call.from_user.id), b=str(call.from_user.username))
    user['quest'] = 100
    with codecs.open(str(user_cd) + str(call.from_user.id) + ".txt", 'w', encoding="UTF-8") as file:
        file.write(str(user))
        file.close()
    await bot.send_message(call.from_user.id, text='*‚ùóÔ∏è–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è —Ä–∞—Å—Å—ã–ª–∫–∏*', parse_mode='Markdown')


@dp.callback_query_handler(text='add_send_photo')
async def vote_up_cb_handler(call):
    user = await reg(a=str(call.from_user.id), b=str(call.from_user.username))
    user['quest'] = 888
    with codecs.open(str(user_cd) + str(call.from_user.id) + ".txt", 'w', encoding="UTF-8") as file:
        file.write(str(user))
        file.close()
    await bot.send_message(call.from_user.id, text='*‚ùóÔ∏è–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–µ–π –¥–ª—è —Ä–∞—Å—Å—ã–ª–∫–∏*', parse_mode='Markdown')


@dp.callback_query_handler(text='add_film')
async def vote_up_cb_handler(call):
    user = await reg(a=str(call.from_user.id), b=str(call.from_user.username))
    user['quest'] = 1
    with codecs.open(str(user_cd) + str(call.from_user.id) + ".txt", 'w', encoding="UTF-8") as file:
        file.write(str(user))
        file.close()
    await bot.send_message(call.from_user.id, text='*–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä, –ø–æ–¥ –∫–æ—Ç–æ—Ä—ã–º –±—É–¥–µ—Ç —Ñ–∏–ª—å–º*', parse_mode='Markdown')



@dp.callback_query_handler(text = 'add_film')
async def vote_up_cb_handler(call):
    user = await reg(a = str(call.from_user.id), b = str(call.from_user.username))

    user['quest'] = 1

    with codecs.open(str(user_cd) + str(call.from_user.id) +".txt", 'w' ,encoding="UTF-8") as file:
        file.write(str(user))
        file.close()

    await bot.send_message(call.from_user.id, text = '*–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä, –ø–æ–¥ –∫–æ—Ç–æ—Ä—ã–º –±—É–¥–µ—Ç —Ñ–∏–ª—å–º*',parse_mode = 'Markdown')


@dp.callback_query_handler(text = 'check')
async def vote_up_cb_handler(call):
    a = 0
    c = 0

    user = await reg(a = str(call.from_user.id), b = str(call.from_user.username))


    with codecs.open(str(channels_cd), 'r' ,encoding="UTF-8") as file:
        channels_me = str(file.readline())
        channels_me = eval(channels_me)
        file.close()


    if len(channels_me) == 0:
        c = 1
    else:
        inline_kb1 = InlineKeyboardMarkup()
        for i in channels_me:
            user_channel_status = await bot.get_chat_member(chat_id='@' + str(i), user_id= call.from_user.id)

            if user_channel_status["status"] == 'left':


                for i in channels_me:
                    inline_btn_1 = InlineKeyboardButton(str(channels_me[i]), url='https://t.me/'+ str(i))

                    inline_kb1.add(inline_btn_1)

                inline_btn_2 = InlineKeyboardButton('–ü–æ–∏—Å–∫', callback_data='check')
                inline_kb1.add(inline_btn_2)
                await bot.send_message(chat_id = call.from_user.id, text = '*üìù –î–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –±–æ—Ç–∞, –≤—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø–æ–¥–ø–∏—Å–∞–Ω—ã –Ω–∞ –Ω–∞—à–∏ –∫–∞–Ω–∞–ª—ã:*',reply_markup = inline_kb1,parse_mode = 'Markdown')
                c = 0
                break
            else:
                c = 1
    if c == 1:

       await bot.send_message(call.from_user.id, text = '*–ü—Ä–∏–≤–µ—Ç —ç—Ç–æ üçø–ö–ò–ù–û–ú–û–õ–û–ö–û - –ë–û–¢ | –ü–æ–∏—Å–∫üîç\n–ß—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ —Ñ–∏–ª—å–º–æ–≤ –∏–∑ –Æ–¢–£–ë | –¢–ò–ö –¢–û–ö –≤–∞–º –Ω—É–∂–Ω–æ –≤–≤–µ—Å—Ç–∏ –∫–æ–¥ —Ñ–∏–ª—å–º–∞.\n–ù–∞–∂–º–∏—Ç–µ –Ω–∞ ¬´üîé–ü–æ–∏—Å–∫¬ª üëá*',parse_mode = 'Markdown',reply_markup = start.greet_kb1)


@dp.message_handler()
async def send_welcome(message):
    a = 0
    c = 0
    user = await reg(a = str(message.from_user.id), b = str(message.from_user.username))


    with codecs.open(str(channels_cd), 'r' ,encoding="UTF-8") as file:
        channels_me = str(file.readline())
        channels_me = eval(channels_me)
        file.close()


    if len(channels_me) == 0:
        c = 1
    else:
        inline_kb1 = InlineKeyboardMarkup()
        for i in channels_me:
            user_channel_status = await bot.get_chat_member(chat_id='@' + str(i), user_id= message.from_user.id)
            if user_channel_status["status"] == 'left':


                for i in channels_me:

                    inline_btn_1 = InlineKeyboardButton(str(channels_me[i]), url='https://t.me/'+ str(i))

                    inline_kb1.add(inline_btn_1)

                inline_btn_2 = InlineKeyboardButton('–ü–æ–∏—Å–∫', callback_data='check')
                inline_kb1.add(inline_btn_2)
                await bot.send_message(chat_id = message.from_user.id, text = '*üìù –î–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –±–æ—Ç–∞, –≤—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø–æ–¥–ø–∏—Å–∞–Ω—ã –Ω–∞ –Ω–∞—à–∏ –∫–∞–Ω–∞–ª—ã:*',reply_markup = inline_kb1,parse_mode = 'Markdown')
                c = 0
                break
            else:
                c = 1
    if c == 1:

        if str(message.text) == 'üîé–ü–æ–∏—Å–∫':
            a = 1
            await bot.send_message(chat_id = message.from_user.id,text = '*üîé –î–ª—è –ø–æ–∏—Å–∫–∞ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –ö–û–î —Ñ–∏–ª—å–º–∞/—Å–µ—Ä–∏–∞–ª–∞*',parse_mode = 'Markdown')
        if user['quest'] == 1 and a == 0:
            a = 1

            with codecs.open(str(film_cd), 'r' ,encoding="UTF-8") as file:
                q = str(file.readline())
                q = eval(q)
                file.close()


            if str(message.text) in q:


                user['quest'] = 0

                with codecs.open(str(user_cd) + str(message.from_user.id) +".txt", 'w' ,encoding="UTF-8") as file:
                    file.write(str(user))
                    file.close()

                await bot.send_message(chat_id = message.from_user.id, text = '*–î–∞–Ω–Ω—ã–π –Ω–æ–º–µ—Ä —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç! –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.*',parse_mode = 'Markdown')

            else:


                user['quest'] = 3
                user['num_film'] = str(message.text)


                with codecs.open(str(user_cd) + str(message.from_user.id) +".txt", 'w' ,encoding="UTF-8") as file:
                    file.write(str(user))
                    file.close()


                await bot.send_message(chat_id = message.from_user.id, text = '*–ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–∏–ª—å–º–∞:*',parse_mode = 'Markdown')

        if user['quest'] == 3 and a == 0:
            a = 1

            user['link_film'] = str(message.text)
            user['quest'] = 992

            with codecs.open(str(user_cd) + str(message.from_user.id) + ".txt", 'w', encoding="UTF-8") as file:
                file.write(str(user))
                file.close()

            await bot.send_message(chat_id=message.from_user.id, text='*–í–≤–µ–¥–∏—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ñ–∏–ª—å–º–µ*',
                                   parse_mode='Markdown')

        if user['quest'] == 992 and a == 0:
            a = 1
            user['info_film'] = str(message.text)
            user['quest'] = 993

            with codecs.open(str(user_cd) + str(message.from_user.id) + ".txt", 'w', encoding="UTF-8") as file:
                file.write(str(user))
                file.close()

            await bot.send_message(chat_id=message.from_user.id, text='*–í–≤–µ–¥–∏—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é –¥–ª—è —Ñ–∏–ª—å–º–∞*',
                                   parse_mode='Markdown')

        if user['quest'] == 993 and a == 0:
            a = 1
            with codecs.open(str(film_cd), 'r', encoding="UTF-8") as file:
                q = str(file.readline())
                q = eval(q)
                file.close()

            q[str(user['num_film'])] = [str(message.text), str(user['link_film']), str(user['info_film'])]

            with codecs.open(str(film_cd), 'w', encoding="UTF-8") as file:
                file.write(str(q))
                file.close()

            user['quest'] = 0

            with codecs.open(str(user_cd) + str(message.from_user.id) + ".txt", 'w', encoding="UTF-8") as file:
                file.write(str(user))
                file.close()

            await bot.send_message(chat_id=message.from_user.id, text='*–§–∏–ª—å–º —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!*',
                                   parse_mode='Markdown')
        if user['quest'] == 100 and a == 0:
            a = 1

            user['quest'] = 0

            with codecs.open(str(user_cd) + str(message.from_user.id) +".txt", 'w' ,encoding="UTF-8") as file:
                file.write(str(user))
                file.close()

            with codecs.open("all_users/all_users.txt", 'r' ,encoding="UTF-8") as file:
                q = str(file.readline())
                q = eval(q)
                file.close()

            for i in q:
                try:
                    await bot.send_message(chat_id = i, text = str(message.text))
                except:
                    pass


            await bot.send_message(chat_id = message.from_user.id, text = '*–†–∞—Å—Å—ã–ª–∫–∞ –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ.*',parse_mode = 'Markdown')


        if user['quest'] == 200 and a == 0:
            a = 1

            user['link_channel'] = str(message.text)

            user['quest'] = 300

            with codecs.open(str(user_cd) + str(message.from_user.id) +".txt", 'w' ,encoding="UTF-8") as file:
                file.write(str(user))
                file.close()


            await bot.send_message(chat_id = message.from_user.id, text = '*–•–æ—Ä–æ—à–æ. –¢–µ–ø–µ—Ä—å —É–∫–∞–∂–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞–Ω–∞–ª–∞*',parse_mode = 'Markdown')

        if user['quest'] == 300 and a == 0:
            a = 1


            user['quest'] = 0

            with codecs.open(str(user_cd) + str(message.from_user.id) +".txt", 'w' ,encoding="UTF-8") as file:
                file.write(str(user))
                file.close()


            with codecs.open(str(channels_cd), 'r' ,encoding="UTF-8") as file:
                channels_me = str(file.readline())
                channels_me = eval(channels_me)
                file.close()


            channels_me[str(user['link_channel'])] = str(message.text)

            with codecs.open(str(channels_cd), 'w' ,encoding="UTF-8") as file:
                file.write(str(channels_me))
                file.close()

            await bot.send_message(chat_id = message.from_user.id, text = '*–ö–∞–Ω–∞–ª —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!*',parse_mode = 'Markdown')


        if user['quest'] == 6661 and a == 0:
            a = 1

            user['quest'] = 0

            with codecs.open(str(user_cd) + str(message.from_user.id) +".txt", 'w' ,encoding="UTF-8") as file:
                file.write(str(user))
                file.close()


            with codecs.open(str(film_cd), 'r' ,encoding="UTF-8") as file:
                q = str(file.readline())
                q = eval(q)
                file.close()


            if str(message.text) in q:
                del q[str(message.text)]

                with codecs.open(str(film_cd), 'w' ,encoding="UTF-8") as file:
                    file.write(str(q))
                    file.close()

                await message.reply('–ù–æ–º–µ—Ä —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª—ë–Ω')

            else:
                await message.reply('–î–∞–Ω–Ω—ã–π –Ω–æ–º–µ—Ä –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç')


        if user['quest'] == 500 and a == 0:
            a = 1


            user['quest'] = 0

            with codecs.open(str(user_cd) + str(message.from_user.id) +".txt", 'w' ,encoding="UTF-8") as file:
                file.write(str(user))
                file.close()


            with codecs.open(str(channels_cd), 'r' ,encoding="UTF-8") as file:
                channels_me = str(file.readline())
                channels_me = eval(channels_me)
                file.close()

            if str(message.text) in channels_me:
                del channels_me[str(message.text)]

                with codecs.open(str(channels_cd), 'w' ,encoding="UTF-8") as file:
                    file.write(str(channels_me))
                    file.close()

                await bot.send_message(chat_id = message.from_user.id,text ='*–ö–∞–Ω–∞–ª —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª—ë–Ω –∏–∑ —Å–ø–∏—Å–∫–∞!*',parse_mode = 'Markdown')

            else:

                await bot.send_message(chat_id = message.from_user.id,text ='*–£–±–µ–¥–∏—Ç–µ—Å—å –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏ –Ω–∞–ø–∏—Å–∞–Ω–∏—è –∫–∞–Ω–∞–ª–∞!*',parse_mode = 'Markdown')

        if a == 0:
            a = 1
            try:
                code = int(message.text)
            except ValueError:
                await bot.send_message(chat_id=message.from_user.id,
                                       text='*–û—à–∏–±–∫–∞: –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –∫–æ–¥. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –∫–æ–¥ –≤ –≤–∏–¥–µ —á–∏—Å–ª–∞.*',
                                       parse_mode='Markdown')
                return

            with codecs.open(str(film_cd), 'r', encoding="UTF-8") as file:
                q = str(file.readline())
                q = eval(q)
                file.close()
            if str(code) in q:
                try:
                    film_info = f"üé¨ *–ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–∏–ª—å–º–∞:* {q[str(code)][1]}\n\n** {q[str(code)][2]}"
                    await bot.send_photo(chat_id=message.from_user.id, photo=str(q[str(code)][0]),
                                         caption=film_info, parse_mode='Markdown')
                except Exception as ex:
                    print(ex)
            else:
                await bot.send_message(chat_id=message.from_user.id,
                                       text='*–û—à–∏–±–∫–∞: –ö–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –∫–æ–¥.*',
                                       parse_mode='Markdown')

if __name__ == '__main__':
    loop = asyncio.get_event_loop()
    loop.run_until_complete(dp.start_polling())







